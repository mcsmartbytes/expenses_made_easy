(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[366],{2904:function(e,t,s){Promise.resolve().then(s.bind(s,4489))},4489:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(7437),l=s(2265),n=s(6463),i=s(7138),r=s(2094);async function d(e){let{data:t}=await r.O.from("user_profiles").select("subscription_plan, subscription_status").eq("user_id",e).single(),s=(null==t?void 0:t.subscription_plan)||"free",a=(null==t?void 0:t.subscription_status)||"inactive",l="active"===a||"trialing"===a,n=0;if(!l){let t=new Date;t.setDate(1),t.setHours(0,0,0,0);let{count:s}=await r.O.from("expenses").select("*",{count:"exact",head:!0}).eq("user_id",e).gte("date",t.toISOString().split("T")[0]);n=s||0}return{plan:s,status:a,isPaidUser:l,isPremium:"premium"===s&&l,isPro:"pro"===s&&l,expenseCount:n,expenseLimit:l?1/0:50}}async function o(e){let t=await d(e);if(t.isPaidUser)return{allowed:!0};let s=t.expenseLimit-t.expenseCount;return s<=0?{allowed:!1,message:"You've reached your limit of 50 expenses this month. Upgrade to Premium for unlimited!",remaining:0}:{allowed:!0,remaining:s}}function c(){let e=(0,n.useRouter)(),[t,s]=(0,l.useState)(!1),[d,c]=(0,l.useState)(!0),[u,m]=(0,l.useState)(!1),[x,h]=(0,l.useState)([]),[p,g]=(0,l.useState)(null),[f,b]=(0,l.useState)(null),[j,y]=(0,l.useState)(null),[v,N]=(0,l.useState)({amount:"",description:"",category_id:"",date:new Date().toISOString().split("T")[0],vendor:"",payment_method:"credit",is_business:!0,notes:""});async function w(){let{data:{user:e}}=await r.O.auth.getUser();e&&y(await o(e.id))}async function k(e){return new Promise((t,s)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=a=>{var l;let n=new Image;n.src=null===(l=a.target)||void 0===l?void 0:l.result,n.onload=()=>{let a=document.createElement("canvas"),l=n.width,i=n.height;l>i?l>1920&&(i*=1920/l,l=1920):i>1920&&(l*=1920/i,i=1920),a.width=l,a.height=i;let r=a.getContext("2d");null==r||r.drawImage(n,0,0,l,i),a.toBlob(a=>{a?t(new File([a],e.name,{type:"image/jpeg",lastModified:Date.now()})):s(Error("Failed to compress image"))},"image/jpeg",.8)},n.onerror=()=>s(Error("Failed to load image"))},a.onerror=()=>s(Error("Failed to read file"))})}async function _(){c(!0);try{let e=await fetch("/api/categories"),t=await e.json();t.success&&t.data&&t.data.length>0&&h(t.data)}catch(e){console.error("Error loading categories:",e)}finally{c(!1)}}async function C(){if(p){m(!0);try{let e=p;p.size>4194304&&(e=await k(p));let t=new FormData;t.append("receipt",e);let s=await fetch("/api/ocr-receipt",{method:"POST",body:t}),a=await s.json();if(!s.ok)throw Error(a.error||"Failed to scan receipt");a.success&&a.data&&(b(a.data),N({...v,amount:a.data.amount||v.amount,vendor:a.data.vendor||v.vendor,date:a.data.date||v.date,description:a.data.description||v.description,payment_method:a.data.payment_method||v.payment_method,notes:a.data.items?"Items: ".concat(a.data.items.join(", ")):v.notes}),alert("✅ Receipt scanned successfully! Review the auto-filled information."))}catch(e){alert("❌ Failed to scan receipt: "+(e.message||"Unknown error"))}finally{m(!1)}}}async function D(t){t.preventDefault(),s(!0);try{let{data:{user:t}}=await r.O.auth.getUser();if(!t){alert("Please sign in");return}let a=await o(t.id);if(!a.allowed){alert(a.message||"You have reached your expense limit. Please upgrade to continue."),s(!1);return}let l=null;if(p){let e=p.name.split(".").pop(),s="".concat(t.id,"/").concat(Date.now(),".").concat(e),{error:a}=await r.O.storage.from("receipts").upload(s,p);if(!a){let{data:{publicUrl:e}}=r.O.storage.from("receipts").getPublicUrl(s);l=e}}let{error:n}=await r.O.from("expenses").insert({...v,amount:parseFloat(v.amount),receipt_url:l,user_id:t.id});if(n)throw n;e.push("/expense-dashboard")}catch(e){alert(e.message||"Failed to add expense")}finally{s(!1)}}return(0,l.useEffect)(()=>{_(),w()},[]),(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto px-4",children:[j&&!j.allowed&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"⚠️"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-red-800",children:"Expense Limit Reached"}),(0,a.jsx)("p",{className:"text-sm text-red-700 mt-1",children:j.message}),(0,a.jsx)(i.default,{href:"/pricing",className:"inline-block mt-3 px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-semibold hover:bg-red-700 transition",children:"Upgrade to Premium"})]})]})}),j&&j.allowed&&void 0!==j.remaining&&j.remaining<=10&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCA1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-yellow-800",children:"Running Low on Free Expenses"}),(0,a.jsxs)("p",{className:"text-sm text-yellow-700 mt-1",children:["You have ",j.remaining," expense",1!==j.remaining?"s":""," remaining this month on the free plan."]}),(0,a.jsx)(i.default,{href:"/pricing",className:"inline-block mt-2 text-sm text-yellow-800 font-semibold hover:text-yellow-900 underline",children:"Upgrade for unlimited expenses →"})]})]})}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(i.default,{href:"/expense-dashboard",className:"text-blue-600 hover:text-blue-700",children:"← Back to Dashboard"})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Add New Expense"}),(0,a.jsxs)("form",{onSubmit:D,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Amount *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-3 top-2.5",children:"$"}),(0,a.jsx)("input",{type:"number",step:"0.01",required:!0,value:v.amount,onChange:e=>N({...v,amount:e.target.value}),className:"w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description *"}),(0,a.jsx)("input",{type:"text",required:!0,value:v.description,onChange:e=>N({...v,description:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"What was this expense for?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Category *"}),(0,a.jsxs)("select",{required:!0,value:v.category_id,onChange:e=>N({...v,category_id:e.target.value}),disabled:d,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:[(0,a.jsx)("option",{value:"",children:d?"Loading categories...":"Select a category"}),x.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))]}),d&&(0,a.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"✨ Setting up your categories for the first time..."}),v.category_id&&(()=>{let e=x.find(e=>e.id===v.category_id);if(!e)return null;let t=parseFloat(v.amount)||0,s=e.deduction_percentage||0,l=(t*s/100).toFixed(2);return(0,a.jsx)("div",{className:"mt-3 p-4 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Tax Information"}),(0,a.jsxs)("div",{className:"space-y-1",children:[100===s&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full font-medium",children:"100% Tax Deductible"}),t>0&&(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["Deductible: ",(0,a.jsxs)("strong",{className:"text-green-700",children:["$",l]})]})]}),50===s&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs rounded-full font-medium",children:"50% Tax Deductible"}),t>0&&(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["Deductible: ",(0,a.jsxs)("strong",{className:"text-yellow-700",children:["$",l]})," of $",t.toFixed(2)]})]}),0===s&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-800 text-xs rounded-full font-medium",children:"Not Tax Deductible"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Personal expenses are not deductible"})]}),s>0&&s<100&&50!==s&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full font-medium",children:[s,"% Tax Deductible"]}),t>0&&(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["Deductible: ",(0,a.jsxs)("strong",{className:"text-blue-700",children:["$",l]})]})]}),e.schedule_c_line&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsxs)("span",{className:"text-xs text-purple-700 font-medium",children:["Schedule C Line ",e.schedule_c_line]})]})]}),50===s&&(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-2 italic",children:"\uD83D\uDCA1 IRS limits business meals to 50% deduction"})]})]})})})()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date *"}),(0,a.jsx)("input",{type:"date",required:!0,value:v.date,onChange:e=>N({...v,date:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Vendor"}),(0,a.jsx)("input",{type:"text",value:v.vendor,onChange:e=>N({...v,vendor:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Where did you make this purchase?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Payment Method"}),(0,a.jsxs)("select",{value:v.payment_method,onChange:e=>N({...v,payment_method:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"credit",children:"Credit Card"}),(0,a.jsx)("option",{value:"debit",children:"Debit Card"}),(0,a.jsx)("option",{value:"cash",children:"Cash"}),(0,a.jsx)("option",{value:"bank_transfer",children:"Bank Transfer"})]})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"checkbox",checked:v.is_business,onChange:e=>N({...v,is_business:e.target.checked}),className:"w-5 h-5 text-blue-600 rounded"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"This is a business expense"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"\uD83D\uDCF8 Receipt Photo (Optional)"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{type:"file",accept:"image/*,.pdf",capture:"environment",onChange:e=>{var t;g((null===(t=e.target.files)||void 0===t?void 0:t[0])||null),b(null)},className:"w-full px-4 py-2 border rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),p&&(0,a.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,a.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"text-sm text-green-800 font-medium",children:["✓ Receipt attached: ",p.name]}),f&&(0,a.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"✨ Scanned - data filled automatically"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{g(null),b(null)},className:"text-xs text-red-600 hover:text-red-700 ml-2",children:"Remove"})]})}),f&&(f.subtotal||f.tax_amount)&&(0,a.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsxs)("h4",{className:"text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2z"})}),"Receipt Breakdown"]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[f.subtotal&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",Number(f.subtotal).toFixed(2)]})]}),null!==f.tax_amount&&void 0!==f.tax_amount&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{className:"text-gray-600",children:["Tax",f.tax_rate?" (".concat(f.tax_rate,"%)"):"",":"]}),(0,a.jsxs)("span",{className:"font-medium text-orange-600",children:["$",Number(f.tax_amount).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-2 border-t border-blue-200",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:"Total:"}),(0,a.jsxs)("span",{className:"font-bold text-blue-600",children:["$",Number(f.amount).toFixed(2)]})]}),f.payment_method&&(0,a.jsxs)("div",{className:"flex justify-between pt-2 text-xs text-gray-500",children:[(0,a.jsx)("span",{children:"Payment Method:"}),(0,a.jsx)("span",{className:"capitalize",children:f.payment_method})]})]})]}),!f&&(0,a.jsx)("button",{type:"button",onClick:C,disabled:u,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold flex items-center justify-center gap-2",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Scanning Receipt with AI..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"\uD83E\uDD16 Scan Receipt with AI"]})})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:'\uD83D\uDCA1 Tip: Take a photo with your phone camera, then click "Scan Receipt with AI" to automatically extract amount, vendor, and date!'})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:v.notes,onChange:e=>N({...v,notes:e.target.value}),rows:3,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Additional details..."})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{type:"submit",disabled:t,className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50",children:t?"Adding...":"Add Expense"}),(0,a.jsx)(i.default,{href:"/expense-dashboard",className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 text-center",children:"Cancel"})]})]})]})]})})}},6463:function(e,t,s){"use strict";var a=s(1169);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},2094:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(2835).eI)("https://vckynnyputrvwjhosryl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZja3lubnlwdXRydndqaG9zcnlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NDQ5OTgsImV4cCI6MjA3NTQyMDk5OH0.wpopXA3AtRSKAJdGqtcEtbBJPcpCGfeqm6VC27JkNEI",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage,storageKey:"expenses-made-easy-auth"}})}},function(e){e.O(0,[138,835,971,23,744],function(){return e(e.s=2904)}),_N_E=e.O()}]);