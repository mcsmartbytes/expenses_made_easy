(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[124],{5939:function(e,t,s){Promise.resolve().then(s.bind(s,8657))},8657:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(7437),n=s(2265),r=s(6079),l=s(2094);function i(){let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)([]),[o,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(0),[x,h]=(0,n.useState)(0),[m,p]=(0,n.useState)(""),[g,f]=(0,n.useState)(""),[b,j]=(0,n.useState)(!0),[N,y]=(0,n.useState)(.67),[v,w]=(0,n.useState)("all"),[D,S]=(0,n.useState)("all"),C=(0,n.useRef)(null),_=(0,n.useRef)(null),k=(0,n.useRef)(!1);async function F(){try{let{data:{user:e}}=await l.O.auth.getUser();if(!e)return;let{data:s}=await l.O.from("mileage").select("*").eq("user_id",e.id).order("date",{ascending:!1});t(s||[])}catch(e){console.error("Error loading trips:",e)}}(0,n.useEffect)(()=>(F(),function(){if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}C.current=navigator.geolocation.watchPosition(e=>{let t=2.237*(e.coords.speed||0);if(u(t),!(t>=5)||o||k.current||(k.current=!0,A()),o&&_.current){let t=function(e,t,s,a){let n=O(s-e),r=O(a-t),l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(O(e))*Math.cos(O(s))*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*3959}(_.current.coords.latitude,_.current.coords.longitude,e.coords.latitude,e.coords.longitude);h(e=>e+t)}_.current=e},e=>{console.error("Geolocation error:",e)},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3})}(),()=>{null!==C.current&&navigator.geolocation.clearWatch(C.current)}),[]),(0,n.useEffect)(()=>{(function(){let t=[...e];"business"===v?t=t.filter(e=>e.is_business):"personal"===v&&(t=t.filter(e=>!e.is_business));let s=new Date;if("month"===D){let e=new Date(s.getFullYear(),s.getMonth(),1);t=t.filter(t=>new Date(t.date)>=e)}else if("quarter"===D){let e=Math.floor(s.getMonth()/3),a=new Date(s.getFullYear(),3*e,1);t=t.filter(e=>new Date(e.date)>=a)}else if("year"===D){let e=new Date(s.getFullYear(),0,1);t=t.filter(t=>new Date(t.date)>=e)}i(t)})()},[e,v,D]);let E=s.reduce((e,t)=>e+t.distance,0),M=s.reduce((e,t)=>e+t.amount,0),T=s.filter(e=>e.is_business).reduce((e,t)=>e+t.distance,0),I=s.filter(e=>!e.is_business).reduce((e,t)=>e+t.distance,0);function O(e){return Math.PI/180*e}async function A(){c(!0),h(0),_.current=null,navigator.geolocation&&navigator.geolocation.getCurrentPosition(async e=>{p(await R(e.coords.latitude,e.coords.longitude))})}async function P(){if(x<.1){alert("Distance too short to save"),c(!1),k.current=!1;return}try{let{data:{user:e}}=await l.O.auth.getUser();if(!e)return;let t="";navigator.geolocation&&_.current&&(t=await R(_.current.coords.latitude,_.current.coords.longitude));let{error:s}=await l.O.from("mileage").insert({user_id:e.id,date:new Date().toISOString().split("T")[0],distance:parseFloat(x.toFixed(2)),start_location:m||"Unknown",end_location:t||"Unknown",purpose:g||"Business trip",is_business:b,rate:N});s||(alert("Trip saved: ".concat(x.toFixed(2)," miles")),c(!1),h(0),f(""),k.current=!1,F())}catch(e){console.error("Error saving trip:",e)}}async function R(e,t){try{let s=await fetch("https://nominatim.openstreetmap.org/reverse?lat=".concat(e,"&lon=").concat(t,"&format=json"));return(await s.json()).display_name||"".concat(e.toFixed(4),", ").concat(t.toFixed(4))}catch(s){return"".concat(e.toFixed(4),", ").concat(t.toFixed(4))}}async function B(e){if(!confirm("Delete this trip?"))return;let{error:t}=await l.O.from("mileage").delete().eq("id",e);t||F()}return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(r.Z,{}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Mileage Tracker"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Auto-Tracking"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Automatically starts when you drive over 5 mph"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-3xl font-bold text-blue-600",children:[d.toFixed(1)," mph"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Current Speed"})]})]}),o&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-green-900",children:"Tracking Active"}),(0,a.jsxs)("p",{className:"text-green-700",children:["Distance: ",x.toFixed(2)," miles"]}),(0,a.jsxs)("p",{className:"text-sm text-green-600",children:["From: ",m||"Loading..."]})]}),(0,a.jsx)("button",{onClick:P,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold",children:"Stop & Save Trip"})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Trip purpose (optional)",value:g,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border rounded-lg"}),(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:b,onChange:e=>j(e.target.checked),className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:"Business trip"})]})]})]}),!o&&(0,a.jsx)("button",{onClick:A,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold",children:"Start Manual Tracking"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Miles"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:E.toFixed(1)})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Amount"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["$",M.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Business Miles"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:T.toFixed(1)})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Personal Miles"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:I.toFixed(1)})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold",children:["Trip History (",s.length," trips)"]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("select",{value:v,onChange:e=>w(e.target.value),className:"px-3 py-1.5 border rounded-lg text-sm",children:[(0,a.jsx)("option",{value:"all",children:"All Types"}),(0,a.jsx)("option",{value:"business",children:"Business"}),(0,a.jsx)("option",{value:"personal",children:"Personal"})]}),(0,a.jsxs)("select",{value:D,onChange:e=>S(e.target.value),className:"px-3 py-1.5 border rounded-lg text-sm",children:[(0,a.jsx)("option",{value:"all",children:"All Time"}),(0,a.jsx)("option",{value:"month",children:"This Month"}),(0,a.jsx)("option",{value:"quarter",children:"This Quarter"}),(0,a.jsx)("option",{value:"year",children:"This Year"})]}),(0,a.jsx)("button",{onClick:function(){if(0===s.length){alert("No trips to export");return}let e=new Blob([["Date,Distance (miles),Purpose,Type,Rate,Amount,Start Location,End Location",...s.map(e=>[e.date,e.distance.toFixed(2),'"'.concat(e.purpose||"No purpose",'"'),e.is_business?"Business":"Personal",e.rate.toFixed(2),e.amount.toFixed(2),'"'.concat(e.start_location||"",'"'),'"'.concat(e.end_location||"",'"')]).map(e=>e.join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="mileage_".concat(new Date().toISOString().split("T")[0],".csv"),t.click()},className:"px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700",children:"Export CSV"})]})]})}),(0,a.jsx)("div",{className:"divide-y",children:0===s.length?(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No trips recorded yet"}):s.map(e=>(0,a.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("span",{className:"font-semibold",children:[e.distance.toFixed(2)," miles"]}),(0,a.jsx)("span",{className:"px-2 py-0.5 text-xs rounded-full ".concat(e.is_business?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:e.is_business?"Business":"Personal"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.purpose||"No purpose"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[new Date(e.date).toLocaleDateString()," | $",e.amount.toFixed(2)]}),(e.start_location||e.end_location)&&(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-1 truncate max-w-md",children:[e.start_location&&"From: ".concat(e.start_location.split(",")[0]),e.start_location&&e.end_location&&" → ",e.end_location&&"To: ".concat(e.end_location.split(",")[0])]})]}),(0,a.jsx)("button",{onClick:()=>B(e.id),className:"text-red-600 hover:text-red-700 text-sm",children:"Delete"})]})},e.id))})]})]})]})}},6079:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var a=s(7437),n=s(2265),r=s(7138),l=s(6463),i=s(2094);function o(){let e=(0,l.usePathname)(),t=(0,l.useRouter)(),[s,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[u,x]=(0,n.useState)(!1);async function h(){let{data:{user:e}}=await i.O.auth.getUser();o(e)}async function m(){d(!0);try{await i.O.auth.signOut(),o(null),x(!1),t.push("/")}catch(e){console.error("Error signing out:",e)}finally{d(!1)}}(0,n.useEffect)(()=>{h()},[]),(0,n.useEffect)(()=>{x(!1)},[e]);let p=[{href:"/expense-dashboard",label:"Dashboard",icon:"\uD83D\uDCCA"},{href:"/expenses",label:"Expenses",icon:"\uD83D\uDCCB"},{href:"/budgets",label:"Budgets",icon:"\uD83D\uDCB0"},{href:"/receipts",label:"Receipts",icon:"\uD83E\uDDFE"},{href:"/mileage",label:"Mileage",icon:"\uD83D\uDE97"},{href:"/reports",label:"Reports",icon:"\uD83D\uDCC8"},{href:"/profile",label:"Profile",icon:"\uD83D\uDC64"}];return(0,a.jsx)("nav",{className:"bg-white shadow-sm border-b",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)(r.default,{href:"/expense-dashboard",className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCB0"}),(0,a.jsx)("span",{className:"text-xl font-bold text-gray-900",children:"Expenses Made Easy"})]}),(0,a.jsxs)("div",{className:"hidden md:flex items-center gap-1",children:[p.map(t=>(0,a.jsxs)(r.default,{href:t.href,className:"px-4 py-2 rounded-lg text-sm font-medium transition ".concat(e===t.href?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"),children:[(0,a.jsx)("span",{className:"mr-1",children:t.icon}),t.label]},t.href)),s?(0,a.jsxs)("button",{onClick:m,disabled:c,className:"ml-2 px-4 py-2 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition disabled:opacity-50",children:[(0,a.jsx)("span",{className:"mr-1",children:"\uD83D\uDEAA"}),c?"Logging out...":"Logout"]}):(0,a.jsxs)(r.default,{href:"/auth/login",className:"ml-2 px-4 py-2 rounded-lg text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition",children:[(0,a.jsx)("span",{className:"mr-1",children:"\uD83D\uDD10"}),"Login"]})]}),(0,a.jsx)("div",{className:"md:hidden",children:(0,a.jsx)("button",{onClick:()=>x(!u),className:"p-2 rounded-lg text-gray-700 hover:bg-gray-100","aria-label":"Toggle menu",children:u?"✕":"☰"})})]}),u&&(0,a.jsx)("div",{className:"md:hidden py-4 border-t",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[p.map(t=>(0,a.jsxs)(r.default,{href:t.href,className:"px-4 py-3 rounded-lg text-sm font-medium transition ".concat(e===t.href?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"),children:[(0,a.jsx)("span",{className:"mr-2",children:t.icon}),t.label]},t.href)),(0,a.jsx)("div",{className:"border-t my-2 pt-2",children:s?(0,a.jsxs)("button",{onClick:m,disabled:c,className:"w-full px-4 py-3 rounded-lg text-sm font-medium text-left text-gray-700 hover:bg-gray-100 transition disabled:opacity-50",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDEAA"}),c?"Logging out...":"Logout"]}):(0,a.jsxs)(r.default,{href:"/auth/login",className:"block px-4 py-3 rounded-lg text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition text-center",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDD10"}),"Login"]})})]})})]})})}},6463:function(e,t,s){"use strict";var a=s(1169);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},2094:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(2835).eI)("https://vckynnyputrvwjhosryl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZja3lubnlwdXRydndqaG9zcnlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NDQ5OTgsImV4cCI6MjA3NTQyMDk5OH0.wpopXA3AtRSKAJdGqtcEtbBJPcpCGfeqm6VC27JkNEI",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage,storageKey:"expenses-made-easy-auth"}})}},function(e){e.O(0,[138,835,971,23,744],function(){return e(e.s=5939)}),_N_E=e.O()}]);