(()=>{var e={};e.id=124,e.ids=[124],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},3082:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>d,routeModule:()=>p,tree:()=>c}),s(2116),s(6001),s(5866);var a=s(3191),r=s(8716),i=s(7922),n=s.n(i),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["mileage",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2116)),"/home/mcsmart/projects/active/expenses_made_easy/app/mileage/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,6001)),"/home/mcsmart/projects/active/expenses_made_easy/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/home/mcsmart/projects/active/expenses_made_easy/app/mileage/page.tsx"],x="/mileage/page",u={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/mileage/page",pathname:"/mileage",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4718:(e,t,s)=>{Promise.resolve().then(s.bind(s,7585))},7585:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(326),r=s(7577),i=s(7553),n=s(2321);function l(){let[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)([]),[o,c]=(0,r.useState)(!1),[d,x]=(0,r.useState)(0),[u,p]=(0,r.useState)(0),[m,h]=(0,r.useState)(""),[g,j]=(0,r.useState)(""),[b,v]=(0,r.useState)(!0),[f,y]=(0,r.useState)(.67),[N,_]=(0,r.useState)("all"),[w,S]=(0,r.useState)("all");(0,r.useRef)(null);let P=(0,r.useRef)(null),q=(0,r.useRef)(!1);async function F(){try{let{data:{user:e}}=await n.O.auth.getUser();if(!e)return;let{data:s}=await n.O.from("mileage").select("*").eq("user_id",e.id).order("date",{ascending:!1});t(s||[])}catch(e){console.error("Error loading trips:",e)}}let T=s.reduce((e,t)=>e+t.distance,0),$=s.reduce((e,t)=>e+t.amount,0),k=s.filter(e=>e.is_business).reduce((e,t)=>e+t.distance,0),C=s.filter(e=>!e.is_business).reduce((e,t)=>e+t.distance,0);async function A(){c(!0),p(0),P.current=null,navigator.geolocation&&navigator.geolocation.getCurrentPosition(async e=>{h(await M(e.coords.latitude,e.coords.longitude))})}async function D(){if(u<.1){alert("Distance too short to save"),c(!1),q.current=!1;return}try{let{data:{user:e}}=await n.O.auth.getUser();if(!e)return;let t="";navigator.geolocation&&P.current&&(t=await M(P.current.coords.latitude,P.current.coords.longitude));let{error:s}=await n.O.from("mileage").insert({user_id:e.id,date:new Date().toISOString().split("T")[0],distance:parseFloat(u.toFixed(2)),start_location:m||"Unknown",end_location:t||"Unknown",purpose:g||"Business trip",is_business:b,rate:f});s||(alert(`Trip saved: ${u.toFixed(2)} miles`),c(!1),p(0),j(""),q.current=!1,F())}catch(e){console.error("Error saving trip:",e)}}async function M(e,t){try{let s=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${e}&lon=${t}&format=json`);return(await s.json()).display_name||`${e.toFixed(4)}, ${t.toFixed(4)}`}catch{return`${e.toFixed(4)}, ${t.toFixed(4)}`}}async function E(e){if(!confirm("Delete this trip?"))return;let{error:t}=await n.O.from("mileage").delete().eq("id",e);t||F()}return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(i.Z,{}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Mileage Tracker"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Auto-Tracking"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Automatically starts when you drive over 5 mph"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-3xl font-bold text-blue-600",children:[d.toFixed(1)," mph"]}),a.jsx("p",{className:"text-sm text-gray-500",children:"Current Speed"})]})]}),o&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-semibold text-green-900",children:"Tracking Active"}),(0,a.jsxs)("p",{className:"text-green-700",children:["Distance: ",u.toFixed(2)," miles"]}),(0,a.jsxs)("p",{className:"text-sm text-green-600",children:["From: ",m||"Loading..."]})]}),a.jsx("button",{onClick:D,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold",children:"Stop & Save Trip"})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[a.jsx("input",{type:"text",placeholder:"Trip purpose (optional)",value:g,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border rounded-lg"}),(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:b,onChange:e=>v(e.target.checked),className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Business trip"})]})]})]}),!o&&a.jsx("button",{onClick:A,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold",children:"Start Manual Tracking"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Total Miles"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.toFixed(1)})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["$",$.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Business Miles"}),a.jsx("p",{className:"text-2xl font-bold text-blue-600",children:k.toFixed(1)})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Personal Miles"}),a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:C.toFixed(1)})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[a.jsx("div",{className:"px-6 py-4 border-b",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold",children:["Trip History (",s.length," trips)"]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("select",{value:N,onChange:e=>_(e.target.value),className:"px-3 py-1.5 border rounded-lg text-sm",children:[a.jsx("option",{value:"all",children:"All Types"}),a.jsx("option",{value:"business",children:"Business"}),a.jsx("option",{value:"personal",children:"Personal"})]}),(0,a.jsxs)("select",{value:w,onChange:e=>S(e.target.value),className:"px-3 py-1.5 border rounded-lg text-sm",children:[a.jsx("option",{value:"all",children:"All Time"}),a.jsx("option",{value:"month",children:"This Month"}),a.jsx("option",{value:"quarter",children:"This Quarter"}),a.jsx("option",{value:"year",children:"This Year"})]}),a.jsx("button",{onClick:function(){if(0===s.length){alert("No trips to export");return}let e=new Blob([["Date,Distance (miles),Purpose,Type,Rate,Amount,Start Location,End Location",...s.map(e=>[e.date,e.distance.toFixed(2),`"${e.purpose||"No purpose"}"`,e.is_business?"Business":"Personal",e.rate.toFixed(2),e.amount.toFixed(2),`"${e.start_location||""}"`,`"${e.end_location||""}"`]).map(e=>e.join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=`mileage_${new Date().toISOString().split("T")[0]}.csv`,t.click()},className:"px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700",children:"Export CSV"})]})]})}),a.jsx("div",{className:"divide-y",children:0===s.length?a.jsx("div",{className:"p-8 text-center text-gray-500",children:"No trips recorded yet"}):s.map(e=>a.jsx("div",{className:"px-6 py-4 hover:bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("span",{className:"font-semibold",children:[e.distance.toFixed(2)," miles"]}),a.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${e.is_business?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:e.is_business?"Business":"Personal"})]}),a.jsx("p",{className:"text-sm text-gray-600",children:e.purpose||"No purpose"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[new Date(e.date).toLocaleDateString()," | $",e.amount.toFixed(2)]}),(e.start_location||e.end_location)&&(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-1 truncate max-w-md",children:[e.start_location&&`From: ${e.start_location.split(",")[0]}`,e.start_location&&e.end_location&&" â†’ ",e.end_location&&`To: ${e.end_location.split(",")[0]}`]})]}),a.jsx("button",{onClick:()=>E(e.id),className:"text-red-600 hover:text-red-700 text-sm",children:"Delete"})]})},e.id))})]})]})]})}},2116:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>l});var a=s(8570);let r=(0,a.createProxy)(String.raw`/home/mcsmart/projects/active/expenses_made_easy/app/mileage/page.tsx`),{__esModule:i,$$typeof:n}=r;r.default;let l=(0,a.createProxy)(String.raw`/home/mcsmart/projects/active/expenses_made_easy/app/mileage/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,471,434,812,246],()=>s(3082));module.exports=a})();