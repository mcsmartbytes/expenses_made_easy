"use strict";(()=>{var e={};e.id=839,e.ids=[839],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7287:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>d,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var o={};r.r(o),r.d(o,{POST:()=>u});var a=r(9303),s=r(8716),n=r(670),i=r(7070);async function u(e){try{let t=(await e.formData()).get("receipt");if(!t)return i.NextResponse.json({error:"No file provided"},{status:400});let r=await t.arrayBuffer(),o=Buffer.from(r).toString("base64"),a=process.env.OPENAI_API_KEY;if(!a)return i.NextResponse.json({error:"OpenAI API key not configured"},{status:500});let s=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"user",content:[{type:"text",text:`Analyze this receipt image and extract the following information in JSON format:
                {
                  "vendor": "merchant/vendor name",
                  "subtotal": "subtotal amount before tax as a number (no currency symbols)",
                  "tax_amount": "tax amount as a number (no currency symbols), use 0 if no tax shown",
                  "tax_rate": "tax rate as a percentage number if shown (e.g., 8.25), otherwise null",
                  "amount": "total amount including tax as a number (no currency symbols)",
                  "date": "date in YYYY-MM-DD format",
                  "description": "brief description of purchase",
                  "items": ["list of purchased items if visible"],
                  "payment_method": "payment method if visible (credit, debit, cash, etc.), otherwise null"
                }

                If any field is not clearly visible, use null. Be precise with the amounts and date.
                The subtotal should be the amount before tax, and amount should be the final total.`},{type:"image_url",image_url:{url:`data:image/jpeg;base64,${o}`}}]}],max_tokens:500,temperature:.1})});if(!s.ok){let e=await s.text();return console.error("OpenAI API error:",e),i.NextResponse.json({error:"Failed to process receipt with AI"},{status:s.status})}let n=await s.json(),u=n.choices[0]?.message?.content;if(!u)return i.NextResponse.json({error:"No response from AI"},{status:500});let p=u.match(/\{[\s\S]*\}/);if(!p)return i.NextResponse.json({error:"Could not parse receipt data"},{status:500});let c=JSON.parse(p[0]);return i.NextResponse.json({success:!0,data:c})}catch(e){return console.error("OCR processing error:",e),i.NextResponse.json({error:e.message||"Failed to process receipt"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/ocr-receipt/route",pathname:"/api/ocr-receipt",filename:"route",bundlePath:"app/api/ocr-receipt/route"},resolvedPagePath:"/home/mcsmart/projects/active/expenses_made_easy/app/api/ocr-receipt/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m}=p,d="/api/ocr-receipt/route";function h(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,972],()=>r(7287));module.exports=o})();